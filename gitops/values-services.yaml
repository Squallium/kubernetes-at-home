applicationsets:
  paperless-ngx:
    namespace: argocd
    additionalLabels: {}
    additionalAnnotations: {}
    finalizers:
      - resources-finalizer.argocd.argoproj.io
    # See PR #10026 (ArgoCD v2.5 or later)
    # goTemplate: false
    generators:
      - matrix:
          generators:
            - clusters: {}
            - git:
                repoURL: https://github.com/Squallium/kubernetes-at-home.git
                revision: main
                files:
                  - path: 'apps/paperless-ngx/{{metadata.labels.environment}}/config.yaml'
    # Ref https://argo-cd.readthedocs.io/en/stable/operator-manual/applicationset/Controlling-Resource-Modification/#allow-temporarily-toggling-auto-sync
    ignoreApplicationDifferences:
      - jsonPointers:
          - /spec/syncPolicy
    # Progressive Syncs is an experimental feature and it must be explicitly enabled
    # Ref: https://argo-cd.readthedocs.io/en/stable/operator-manual/applicationset/Progressive-Syncs/#enabling-progressive-syncs
    #      strategy:
    #        type: RollingSync
    #        rollingSync:
    #          steps:
    #          - matchExpressions:
    #            - key: project
    #              operator: In
    #              values:
    #              - guestbook
    #          - matchExpressions:
    #            - key: project
    #              operator: In
    #              values:
    #              - kustomize-foo
    #              - kustomize-bar
    template:
      metadata:
        name: 'paperless-ngx-{{metadata.labels.environment}}'
        labels:
          type: 'service'
        annotations:
          kargo.akuity.io/authorized-stage: 'paperless-ngx:{{metadata.labels.kargo-stage}}'
      spec:
        project: default
        sources:
          - repoURL: https://github.com/Squallium/kubernetes-at-home.git
            targetRevision: main
            ref: values
          - repoURL: https://squallium.github.io/kubernetes-at-home
            chart: paperless-ngx
            targetRevision: '{{chart.targetRevision}}'
            helm:
              valueFiles:
                - $values/apps/paperless-ngx/values.yaml
                - $values/apps/paperless-ngx/{{metadata.labels.environment}}/values.yaml
                - $values/apps/paperless-ngx/{{metadata.labels.environment}}/values-ssl.yaml
                - $values/defaults/{{metadata.labels.environment}}/resources/values.yaml
        destination:
          server: '{{server}}'
          namespace: paperless-ngx
        syncPolicy:
#            automated:
#              prune: false
#              selfHeal: false
          syncOptions:
            - CreateNamespace=true
        ignoreDifferences:
          - group: apps
            kind: Deployment
            jsonPointers:
              - /spec/replicas
        info:
          - name: url
            value: https://argoproj.github.io/
    syncPolicy:
      # Set Application finalizer
      preserveResourcesOnDeletion: true
    # Templating is only available on string type
  #      templatePatch: |
  #        spec:
  #          source:
  #            helm:
  #              valueFiles:
  #              {{- range $valueFile := .valueFiles }}
  #                - {{ $valueFile }}
  #              {{- end }}
  #        {{- if .autoSync }}
  #          syncPolicy:
  #            automated:
  #              prune: {{ .prune }}
  #        {{- end }}
  home-assistant:
    namespace: argocd
    additionalLabels: {}
    additionalAnnotations: {}
    finalizers:
      - resources-finalizer.argocd.argoproj.io
    # See PR #10026 (ArgoCD v2.5 or later)
    # goTemplate: false
    generators:
      - matrix:
          generators:
            - clusters: {}
            - git:
                repoURL: https://github.com/Squallium/kubernetes-at-home.git
                revision: main
                files:
                  - path: 'apps/home-assistant/{{metadata.labels.environment}}/config.yaml'
    # Ref https://argo-cd.readthedocs.io/en/stable/operator-manual/applicationset/Controlling-Resource-Modification/#allow-temporarily-toggling-auto-sync
    ignoreApplicationDifferences:
      - jsonPointers:
          - /spec/syncPolicy
    # Progressive Syncs is an experimental feature and it must be explicitly enabled
    # Ref: https://argo-cd.readthedocs.io/en/stable/operator-manual/applicationset/Progressive-Syncs/#enabling-progressive-syncs
    #      strategy:
    #        type: RollingSync
    #        rollingSync:
    #          steps:
    #          - matchExpressions:
    #            - key: project
    #              operator: In
    #              values:
    #              - guestbook
    #          - matchExpressions:
    #            - key: project
    #              operator: In
    #              values:
    #              - kustomize-foo
    #              - kustomize-bar
    template:
      metadata:
        name: 'home-assistant-{{metadata.labels.environment}}'
        labels:
          type: 'service'
        annotations:
          kargo.akuity.io/authorized-stage: 'home-assistant:{{metadata.labels.kargo-stage}}'
      spec:
        project: default
        sources:
          - repoURL: https://github.com/Squallium/kubernetes-at-home.git
            targetRevision: main
            ref: values
          - repoURL: https://pajikos.github.io/home-assistant-helm-chart
            chart: home-assistant
            targetRevision: '{{chart.targetRevision}}'
            helm:
              valueFiles:
                - $values/apps/home-assistant/values.yaml
                - $values/apps/home-assistant/{{metadata.labels.environment}}/values.yaml
                - $values/apps/home-assistant/{{metadata.labels.environment}}/values-ssl.yaml
                - $values/defaults/{{metadata.labels.environment}}/resources/values.yaml
        destination:
          server: '{{server}}'
          namespace: home-assistant
        syncPolicy:
#            automated:
#              prune: false
#              selfHeal: false
          syncOptions:
            - CreateNamespace=true
        ignoreDifferences:
          - group: apps
            kind: Deployment
            jsonPointers:
              - /spec/replicas
          - group: apps
            kind: StatefulSet
            name: home-assistant-{{metadata.labels.environment}}
            jsonPointers:
              - /spec/template/metadata/annotations/checksum~1hass-configuration
        info:
          - name: url
            value: https://argoproj.github.io/
    syncPolicy:
      # Set Application finalizer
      preserveResourcesOnDeletion: true
    # Templating is only available on string type
  #      templatePatch: |
  #        spec:
  #          source:
  #            helm:
  #              valueFiles:
  #              {{- range $valueFile := .valueFiles }}
  #                - {{ $valueFile }}
  #              {{- end }}
  #        {{- if .autoSync }}
  #          syncPolicy:
  #            automated:
  #              prune: {{ .prune }}
  #        {{- end }}
  calibre-web:
    namespace: argocd
    additionalLabels: {}
    additionalAnnotations: {}
    finalizers:
      - resources-finalizer.argocd.argoproj.io
    # See PR #10026 (ArgoCD v2.5 or later)
    # goTemplate: false
    generators:
      - matrix:
          generators:
            - clusters: {}
            - git:
                repoURL: https://github.com/Squallium/kubernetes-at-home.git
                revision: main
                files:
                  - path: 'apps/calibre-web/{{metadata.labels.environment}}/config.yaml'
    # Ref https://argo-cd.readthedocs.io/en/stable/operator-manual/applicationset/Controlling-Resource-Modification/#allow-temporarily-toggling-auto-sync
    ignoreApplicationDifferences:
      - jsonPointers:
          - /spec/syncPolicy
    # Progressive Syncs is an experimental feature and it must be explicitly enabled
    # Ref: https://argo-cd.readthedocs.io/en/stable/operator-manual/applicationset/Progressive-Syncs/#enabling-progressive-syncs
    #      strategy:
    #        type: RollingSync
    #        rollingSync:
    #          steps:
    #          - matchExpressions:
    #            - key: project
    #              operator: In
    #              values:
    #              - guestbook
    #          - matchExpressions:
    #            - key: project
    #              operator: In
    #              values:
    #              - kustomize-foo
    #              - kustomize-bar
    template:
      metadata:
        name: 'calibre-web-{{metadata.labels.environment}}'
        labels:
          type: 'service'
        annotations:
          kargo.akuity.io/authorized-stage: 'calibre-web:{{metadata.labels.kargo-stage}}'
      spec:
        project: default
        sources:
          - repoURL: https://github.com/Squallium/kubernetes-at-home.git
            targetRevision: main
            ref: values
          - repoURL: https://squallium.github.io/kubernetes-at-home
            chart: calibre-web
            targetRevision: '{{chart.targetRevision}}'
            helm:
              valueFiles:
                - $values/apps/calibre-web/values.yaml
                - $values/apps/calibre-web/{{metadata.labels.environment}}/values.yaml
                - $values/apps/calibre-web/{{metadata.labels.environment}}/values-ssl.yaml
                - $values/defaults/{{metadata.labels.environment}}/resources/values.yaml
        destination:
          server: '{{server}}'
          namespace: calibre-web
        syncPolicy:
#            automated:
#              prune: false
#              selfHeal: false
          syncOptions:
            - CreateNamespace=true
        ignoreDifferences:
          - group: apps
            kind: Deployment
            jsonPointers:
              - /spec/replicas
        info:
          - name: url
            value: https://argoproj.github.io/
    syncPolicy:
      # Set Application finalizer
      preserveResourcesOnDeletion: true
    # Templating is only available on string type
  #      templatePatch: |
  #        spec:
  #          source:
  #            helm:
  #              valueFiles:
  #              {{- range $valueFile := .valueFiles }}
  #                - {{ $valueFile }}
  #              {{- end }}
  #        {{- if .autoSync }}
  #          syncPolicy:
  #            automated:
  #              prune: {{ .prune }}
  #        {{- end }}
  authentik:
    namespace: argocd
    additionalLabels: {}
    additionalAnnotations: {}
    finalizers:
      - resources-finalizer.argocd.argoproj.io
    # See PR #10026 (ArgoCD v2.5 or later)
    # goTemplate: false
    generators:
      - matrix:
          generators:
            - clusters: {}
            - git:
                repoURL: https://github.com/Squallium/kubernetes-at-home.git
                revision: main
                files:
                  - path: 'apps/authentik/{{metadata.labels.environment}}/config.yaml'
    # Ref https://argo-cd.readthedocs.io/en/stable/operator-manual/applicationset/Controlling-Resource-Modification/#allow-temporarily-toggling-auto-sync
    ignoreApplicationDifferences:
      - jsonPointers:
          - /spec/syncPolicy
    # Progressive Syncs is an experimental feature and it must be explicitly enabled
    # Ref: https://argo-cd.readthedocs.io/en/stable/operator-manual/applicationset/Progressive-Syncs/#enabling-progressive-syncs
    #      strategy:
    #        type: RollingSync
    #        rollingSync:
    #          steps:
    #          - matchExpressions:
    #            - key: project
    #              operator: In
    #              values:
    #              - guestbook
    #          - matchExpressions:
    #            - key: project
    #              operator: In
    #              values:
    #              - kustomize-foo
    #              - kustomize-bar
    template:
      metadata:
        name: 'authentik-{{metadata.labels.environment}}'
        labels:
          type: 'service'
        annotations:
          kargo.akuity.io/authorized-stage: 'authentik:{{metadata.labels.kargo-stage}}'
      spec:
        project: default
        sources:
          - repoURL: https://github.com/Squallium/kubernetes-at-home.git
            targetRevision: main
            ref: values
          - repoURL: https://charts.goauthentik.io
            chart: authentik
            targetRevision: '{{chart.targetRevision}}'
            helm:
              valueFiles:
                - $values/apps/authentik/values.yaml
                - $values/apps/authentik/{{metadata.labels.environment}}/values.yaml
                - $values/apps/authentik/{{metadata.labels.environment}}/values-ssl.yaml
                - $values/defaults/{{metadata.labels.environment}}/resources/values.yaml
              fileParameters:
                - name: authentik.postgresql.user
                  path: secrets+literal://vals!ref+vault://secret/authentik/{{metadata.labels.environment}}/postgres#/username
                - name: authentik.postgresql.password
                  path: secrets+literal://vals!ref+vault://secret/authentik/{{metadata.labels.environment}}/postgres#/password
                - name: authentik.redis.password
                  path: secrets+literal://vals!ref+vault://secret/authentik/{{metadata.labels.environment}}/redis#/password
        destination:
          server: '{{server}}'
          namespace: authentik
        syncPolicy:
#            automated:
#              prune: false
#              selfHeal: false
          syncOptions:
            - CreateNamespace=true
        ignoreDifferences:
          - group: apps
            kind: Deployment
            jsonPointers:
              - /spec/replicas
        info:
          - name: url
            value: https://argoproj.github.io/
    syncPolicy:
      # Set Application finalizer
      preserveResourcesOnDeletion: true
    # Templating is only available on string type
  #      templatePatch: |
  #        spec:
  #          source:
  #            helm:
  #              valueFiles:
  #              {{- range $valueFile := .valueFiles }}
  #                - {{ $valueFile }}
  #              {{- end }}
  #        {{- if .autoSync }}
  #          syncPolicy:
  #            automated:
  #              prune: {{ .prune }}
  #        {{- end }}
  argo-rollouts:
    namespace: argocd
    additionalLabels: {}
    additionalAnnotations: {}
    finalizers:
      - resources-finalizer.argocd.argoproj.io
    # See PR #10026 (ArgoCD v2.5 or later)
    # goTemplate: false
    generators:
      - matrix:
          generators:
            - clusters: {}
            - git:
                repoURL: https://github.com/Squallium/kubernetes-at-home.git
                revision: main
                files:
                  - path: 'apps/argo-rollouts/{{metadata.labels.environment}}/config.yaml'
    # Ref https://argo-cd.readthedocs.io/en/stable/operator-manual/applicationset/Controlling-Resource-Modification/#allow-temporarily-toggling-auto-sync
    ignoreApplicationDifferences:
      - jsonPointers:
          - /spec/syncPolicy
    # Progressive Syncs is an experimental feature and it must be explicitly enabled
    # Ref: https://argo-cd.readthedocs.io/en/stable/operator-manual/applicationset/Progressive-Syncs/#enabling-progressive-syncs
    #      strategy:
    #        type: RollingSync
    #        rollingSync:
    #          steps:
    #          - matchExpressions:
    #            - key: project
    #              operator: In
    #              values:
    #              - guestbook
    #          - matchExpressions:
    #            - key: project
    #              operator: In
    #              values:
    #              - kustomize-foo
    #              - kustomize-bar
    template:
      metadata:
        name: 'argo-rollouts-{{metadata.labels.environment}}'
        labels:
          type: 'service'
        annotations: {}
      spec:
        project: default
        sources:
          - repoURL: https://github.com/Squallium/kubernetes-at-home.git
            targetRevision: main
            ref: values
          - repoURL: https://argoproj.github.io/argo-helm
            chart: argo-rollouts
            targetRevision: '{{chart.targetRevision}}'
            helm:
              valueFiles:
                - $values/apps/argo-rollouts/values.yaml
                - $values/apps/argo-rollouts/{{metadata.labels.environment}}/values.yaml
                - $values/defaults/{{metadata.labels.environment}}/resources/values.yaml
        destination:
          server: '{{server}}'
          namespace: argo-rollouts
        syncPolicy:
#            automated:
#              prune: false
#              selfHeal: false
          syncOptions:
            - CreateNamespace=true
        ignoreDifferences:
          - group: apps
            kind: Deployment
            jsonPointers:
              - /spec/replicas
        info:
          - name: url
            value: https://argoproj.github.io/
    syncPolicy:
      # Set Application finalizer
      preserveResourcesOnDeletion: true
    # Templating is only available on string type
  #      templatePatch: |
  #        spec:
  #          source:
  #            helm:
  #              valueFiles:
  #              {{- range $valueFile := .valueFiles }}
  #                - {{ $valueFile }}
  #              {{- end }}
  #        {{- if .autoSync }}
  #          syncPolicy:
  #            automated:
  #              prune: {{ .prune }}
  #        {{- end }}
  prowlarr:
    namespace: argocd
    additionalLabels: {}
    additionalAnnotations: {}
    finalizers:
      - resources-finalizer.argocd.argoproj.io
    # See PR #10026 (ArgoCD v2.5 or later)
    # goTemplate: false
    generators:
      - matrix:
          generators:
            - clusters: {}
            - git:
                repoURL: https://github.com/Squallium/kubernetes-at-home.git
                revision: main
                files:
                  - path: 'apps/prowlarr/{{metadata.labels.environment}}/config.yaml'
    # Ref https://argo-cd.readthedocs.io/en/stable/operator-manual/applicationset/Controlling-Resource-Modification/#allow-temporarily-toggling-auto-sync
    ignoreApplicationDifferences:
      - jsonPointers:
          - /spec/syncPolicy
    # Progressive Syncs is an experimental feature and it must be explicitly enabled
    # Ref: https://argo-cd.readthedocs.io/en/stable/operator-manual/applicationset/Progressive-Syncs/#enabling-progressive-syncs
    #      strategy:
    #        type: RollingSync
    #        rollingSync:
    #          steps:
    #          - matchExpressions:
    #            - key: project
    #              operator: In
    #              values:
    #              - guestbook
    #          - matchExpressions:
    #            - key: project
    #              operator: In
    #              values:
    #              - kustomize-foo
    #              - kustomize-bar
    template:
      metadata:
        name: 'prowlarr-{{metadata.labels.environment}}'
        labels:
          type: 'service'
        annotations: {}
      spec:
        project: default
        sources:
          - repoURL: https://github.com/Squallium/kubernetes-at-home.git
            targetRevision: main
            ref: values
          - repoURL: https://squallium.github.io/kubernetes-at-home
            chart: prowlarr
            targetRevision: '{{chart.targetRevision}}'
            helm:
              valueFiles:
                - $values/apps/prowlarr/values.yaml
                - $values/apps/prowlarr/{{metadata.labels.environment}}/values.yaml
                - $values/apps/prowlarr/{{metadata.labels.environment}}/values-ssl.yaml
                - $values/defaults/{{metadata.labels.environment}}/resources/values.yaml
        destination:
          server: '{{server}}'
          namespace: prowlarr
        syncPolicy:
#            automated:
#              prune: false
#              selfHeal: false
          syncOptions:
            - CreateNamespace=true
        ignoreDifferences:
          - group: apps
            kind: Deployment
            jsonPointers:
              - /spec/replicas
        info:
          - name: url
            value: https://argoproj.github.io/
    syncPolicy:
      # Set Application finalizer
      preserveResourcesOnDeletion: true
    # Templating is only available on string type
  #      templatePatch: |
  #        spec:
  #          source:
  #            helm:
  #              valueFiles:
  #              {{- range $valueFile := .valueFiles }}
  #                - {{ $valueFile }}
  #              {{- end }}
  #        {{- if .autoSync }}
  #          syncPolicy:
  #            automated:
  #              prune: {{ .prune }}
  #        {{- end }}
  vikunja:
    namespace: argocd
    additionalLabels: {}
    additionalAnnotations: {}
    finalizers:
      - resources-finalizer.argocd.argoproj.io
    # See PR #10026 (ArgoCD v2.5 or later)
    # goTemplate: false
    generators:
      - matrix:
          generators:
            - clusters: {}
            - git:
                repoURL: https://github.com/Squallium/kubernetes-at-home.git
                revision: main
                files:
                  - path: 'apps/vikunja/{{metadata.labels.environment}}/config.yaml'
    # Ref https://argo-cd.readthedocs.io/en/stable/operator-manual/applicationset/Controlling-Resource-Modification/#allow-temporarily-toggling-auto-sync
    ignoreApplicationDifferences:
      - jsonPointers:
          - /spec/syncPolicy
    # Progressive Syncs is an experimental feature and it must be explicitly enabled
    # Ref: https://argo-cd.readthedocs.io/en/stable/operator-manual/applicationset/Progressive-Syncs/#enabling-progressive-syncs
    #      strategy:
    #        type: RollingSync
    #        rollingSync:
    #          steps:
    #          - matchExpressions:
    #            - key: project
    #              operator: In
    #              values:
    #              - guestbook
    #          - matchExpressions:
    #            - key: project
    #              operator: In
    #              values:
    #              - kustomize-foo
    #              - kustomize-bar
    template:
      metadata:
        name: 'vikunja-{{metadata.labels.environment}}'
        labels:
          type: 'service'
        annotations: {}
      spec:
        project: default
        sources:
          - repoURL: https://github.com/Squallium/kubernetes-at-home.git
            targetRevision: main
            ref: values
          - repoURL: https://squallium.github.io/kubernetes-at-home
            chart: vikunja
            targetRevision: '{{chart.targetRevision}}'
            helm:
              valueFiles:
                - $values/apps/vikunja/values.yaml
                - $values/apps/vikunja/{{metadata.labels.environment}}/values.yaml
                - $values/apps/vikunja/{{metadata.labels.environment}}/values-ssl.yaml
                - $values/defaults/{{metadata.labels.environment}}/resources/values.yaml
              fileParameters:
                - name: auth.openid.client_id
                  path: secrets+literal://vals!ref+vault://secret/vikunja/{{metadata.labels.environment}}/authentik#/client_id
                - name: auth.openid.client_secret
                  path: secrets+literal://vals!ref+vault://secret/vikunja/{{metadata.labels.environment}}/authentik#/client_secret
        destination:
          server: '{{server}}'
          namespace: vikunja
        syncPolicy:
#            automated:
#              prune: false
#              selfHeal: false
          syncOptions:
            - CreateNamespace=true
        ignoreDifferences:
          - group: apps
            kind: Deployment
            jsonPointers:
              - /spec/replicas
        info:
          - name: url
            value: https://argoproj.github.io/
    syncPolicy:
      # Set Application finalizer
      preserveResourcesOnDeletion: true
    # Templating is only available on string type
  #      templatePatch: |
  #        spec:
  #          source:
  #            helm:
  #              valueFiles:
  #              {{- range $valueFile := .valueFiles }}
  #                - {{ $valueFile }}
  #              {{- end }}
  #        {{- if .autoSync }}
  #          syncPolicy:
  #            automated:
  #              prune: {{ .prune }}
  #        {{- end }}
  warracker:
    namespace: argocd
    additionalLabels: {}
    additionalAnnotations: {}
    finalizers:
      - resources-finalizer.argocd.argoproj.io
    # See PR #10026 (ArgoCD v2.5 or later)
    # goTemplate: false
    generators:
      - matrix:
          generators:
            - clusters: {}
            - git:
                repoURL: https://github.com/Squallium/kubernetes-at-home.git
                revision: main
                files:
                  - path: 'apps/warracker/{{metadata.labels.environment}}/config.yaml'
    # Ref https://argo-cd.readthedocs.io/en/stable/operator-manual/applicationset/Controlling-Resource-Modification/#allow-temporarily-toggling-auto-sync
    ignoreApplicationDifferences:
      - jsonPointers:
          - /spec/syncPolicy
    # Progressive Syncs is an experimental feature and it must be explicitly enabled
    # Ref: https://argo-cd.readthedocs.io/en/stable/operator-manual/applicationset/Progressive-Syncs/#enabling-progressive-syncs
    #      strategy:
    #        type: RollingSync
    #        rollingSync:
    #          steps:
    #          - matchExpressions:
    #            - key: project
    #              operator: In
    #              values:
    #              - guestbook
    #          - matchExpressions:
    #            - key: project
    #              operator: In
    #              values:
    #              - kustomize-foo
    #              - kustomize-bar
    template:
      metadata:
        name: 'warracker-{{metadata.labels.environment}}'
        labels:
          type: 'service'
        annotations: {}
      spec:
        project: default
        sources:
          - repoURL: https://github.com/Squallium/kubernetes-at-home.git
            targetRevision: main
            ref: values
          - repoURL: https://squallium.github.io/kubernetes-at-home
            chart: warracker
            targetRevision: '{{chart.targetRevision}}'
            helm:
              valueFiles:
                - $values/apps/warracker/values.yaml
                - $values/apps/warracker/{{metadata.labels.environment}}/values.yaml
                - $values/apps/warracker/{{metadata.labels.environment}}/values-ssl.yaml
                - $values/defaults/{{metadata.labels.environment}}/resources/values.yaml
        destination:
          server: '{{server}}'
          namespace: warracker
        syncPolicy:
#            automated:
#              prune: false
#              selfHeal: false
          syncOptions:
            - CreateNamespace=true
        ignoreDifferences:
          - group: apps
            kind: Deployment
            jsonPointers:
              - /spec/replicas
        info:
          - name: url
            value: https://argoproj.github.io/
    syncPolicy:
      # Set Application finalizer
      preserveResourcesOnDeletion: true
    # Templating is only available on string type
  #      templatePatch: |
  #        spec:
  #          source:
  #            helm:
  #              valueFiles:
  #              {{- range $valueFile := .valueFiles }}
  #                - {{ $valueFile }}
  #              {{- end }}
  #        {{- if .autoSync }}
  #          syncPolicy:
  #            automated:
  #              prune: {{ .prune }}
  #        {{- end }}
  home-assistant-config:
    namespace: argocd
    additionalLabels: {}
    additionalAnnotations: {}
    finalizers:
      - resources-finalizer.argocd.argoproj.io
    # See PR #10026 (ArgoCD v2.5 or later)
    # goTemplate: false
    generators:
      - matrix:
          generators:
            - clusters: {}
            - git:
                repoURL: https://github.com/Squallium/kubernetes-at-home.git
                revision: main
                files:
                  - path: 'apps/home-assistant/config/{{metadata.labels.environment}}/values.yaml'
    # Ref https://argo-cd.readthedocs.io/en/stable/operator-manual/applicationset/Controlling-Resource-Modification/#allow-temporarily-toggling-auto-sync
    ignoreApplicationDifferences:
      - jsonPointers:
          - /spec/syncPolicy
    # Progressive Syncs is an experimental feature and it must be explicitly enabled
    # Ref: https://argo-cd.readthedocs.io/en/stable/operator-manual/applicationset/Progressive-Syncs/#enabling-progressive-syncs
    #      strategy:
    #        type: RollingSync
    #        rollingSync:
    #          steps:
    #          - matchExpressions:
    #            - key: project
    #              operator: In
    #              values:
    #              - guestbook
    #          - matchExpressions:
    #            - key: project
    #              operator: In
    #              values:
    #              - kustomize-foo
    #              - kustomize-bar
    template:
      metadata:
        name: 'home-assistant-config-{{metadata.labels.environment}}'
        labels:
          type: 'service-config'
        annotations: {}
      spec:
        project: default
        sources:
          - repoURL: https://github.com/Squallium/kubernetes-at-home.git
            targetRevision: main
            ref: values
          - repoURL: https://squallium.github.io/kubernetes-at-home
            chart: home-assistant-config
            targetRevision: 0.0.12
            helm:
              valueFiles:
                - $values/apps/home-assistant/config/values.yaml
                - $values/apps/home-assistant/config/{{metadata.labels.environment}}/values.yaml
                - $values/defaults/{{metadata.labels.environment}}/resources/values.yaml
        destination:
          server: '{{server}}'
          namespace: home-assistant
        syncPolicy:
#            automated:
#              prune: false
#              selfHeal: false
          syncOptions:
            - CreateNamespace=true
        ignoreDifferences:
          - group: apps
            kind: Deployment
            jsonPointers:
              - /spec/replicas
        info:
          - name: url
            value: https://argoproj.github.io/
    syncPolicy:
      # Set Application finalizer
      preserveResourcesOnDeletion: true
    # Templating is only available on string type
  #      templatePatch: |
  #        spec:
  #          source:
  #            helm:
  #              valueFiles:
  #              {{- range $valueFile := .valueFiles }}
  #                - {{ $valueFile }}
  #              {{- end }}
  #        {{- if .autoSync }}
  #          syncPolicy:
  #            automated:
  #              prune: {{ .prune }}
  #        {{- end }}
  authentik-config:
    namespace: argocd
    additionalLabels: {}
    additionalAnnotations: {}
    finalizers:
      - resources-finalizer.argocd.argoproj.io
    # See PR #10026 (ArgoCD v2.5 or later)
    # goTemplate: false
    generators:
      - matrix:
          generators:
            - clusters: {}
            - git:
                repoURL: https://github.com/Squallium/kubernetes-at-home.git
                revision: main
                files:
                  - path: 'apps/authentik/config/{{metadata.labels.environment}}/values.yaml'
    # Ref https://argo-cd.readthedocs.io/en/stable/operator-manual/applicationset/Controlling-Resource-Modification/#allow-temporarily-toggling-auto-sync
    ignoreApplicationDifferences:
      - jsonPointers:
          - /spec/syncPolicy
    # Progressive Syncs is an experimental feature and it must be explicitly enabled
    # Ref: https://argo-cd.readthedocs.io/en/stable/operator-manual/applicationset/Progressive-Syncs/#enabling-progressive-syncs
    #      strategy:
    #        type: RollingSync
    #        rollingSync:
    #          steps:
    #          - matchExpressions:
    #            - key: project
    #              operator: In
    #              values:
    #              - guestbook
    #          - matchExpressions:
    #            - key: project
    #              operator: In
    #              values:
    #              - kustomize-foo
    #              - kustomize-bar
    template:
      metadata:
        name: 'authentik-config-{{metadata.labels.environment}}'
        labels:
          type: 'service-config'
        annotations: {}
      spec:
        project: default
        sources:
          - repoURL: https://github.com/Squallium/kubernetes-at-home.git
            targetRevision: main
            ref: values
          - repoURL: https://squallium.github.io/kubernetes-at-home
            chart: authentik-config
            targetRevision: 0.0.8
            helm:
              valueFiles:
                - $values/apps/authentik/config/values.yaml
                - $values/apps/authentik/config/{{metadata.labels.environment}}/values.yaml
                - $values/defaults/{{metadata.labels.environment}}/resources/values.yaml
        destination:
          server: '{{server}}'
          namespace: authentik
        syncPolicy:
#            automated:
#              prune: false
#              selfHeal: false
          syncOptions:
            - CreateNamespace=true
        ignoreDifferences:
          - group: apps
            kind: Deployment
            jsonPointers:
              - /spec/replicas
        info:
          - name: url
            value: https://argoproj.github.io/
    syncPolicy:
      # Set Application finalizer
      preserveResourcesOnDeletion: true
    # Templating is only available on string type
  #      templatePatch: |
  #        spec:
  #          source:
  #            helm:
  #              valueFiles:
  #              {{- range $valueFile := .valueFiles }}
  #                - {{ $valueFile }}
  #              {{- end }}
  #        {{- if .autoSync }}
  #          syncPolicy:
  #            automated:
  #              prune: {{ .prune }}
  #        {{- end }}

applications:
  home-assistant-addons:
    namespace: argocd
    additionalLabels: {}
    additionalAnnotations: {}
    finalizers:
    - resources-finalizer.argocd.argoproj.io
    project: default
    sources:
    - repoURL: https://github.com/Squallium/kubernetes-at-home.git
      targetRevision: main
      ref: values
    - repoURL: https://squallium.github.io/kubernetes-at-home
      chart: home-assistant-addons
      targetRevision: 0.0.16
      helm:
        valueFiles:
          - $values/apps/home-assistant-addons/values.yaml
        values: |
          enable_kargo: true
    destination:
      server: https://kubernetes.default.svc
      namespace: argocd
    syncPolicy:
#      automated:
#        prune: false
#        selfHeal: false
      syncOptions:
      - CreateNamespace=true
    revisionHistoryLimit: null
    ignoreDifferences:
    - group: apps
      kind: Deployment
      jsonPointers:
      - /spec/replicas
    info:
    - name: url
      value: https://argoproj.github.io/