grafana:
  enabled: false

prometheus:
  ingress:
    enabled: true
    ingressClassName: public
    hosts:
      - prometheus-dev.internal
    paths:
      - /
    pathType: Prefix

  prometheusSpec:
    enableRemoteWriteReceiver: false

    scrapeClasses:
      - default: true
        name: cluster-relabeling
        relabelings:
          - sourceLabels: [ __name__ ]
            regex: (.*)
            targetLabel: cluster
            replacement: dev
            action: replace

    serviceMonitorSelectorNilUsesHelmValues: false
    podMonitorSelectorNilUsesHelmValues: false
    retention: 12h

    storageSpec:
      volumeClaimTemplate:
        spec:
          accessModes: [ "ReadWriteOnce" ]
          resources:
            requests:
              storage: 2Gi
          storageClassName: "microk8s-hostpath"

    additionalScrapeConfigs: []

    serviceMonitorSelector:
      matchLabels:
        release: kube-prometheus-stack

    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 200m
        memory: 256Mi

    # Remote write to the core cluster Prometheus
    remoteWrite:
      - url: http://prometheus.internal/api/v1/write
        writeRelabelConfigs:
          - sourceLabels: [__name__]
            regex: (.*)
            targetLabel: cluster
            replacement: dev
            action: replace

kubelet:
  serviceMonitor:
    metricRelabelings:
      # ---- chart defaults ----
      - action: drop
        sourceLabels: [__name__, le]
        regex: (csi_operations|storage_operation_duration)_seconds_bucket;(0.25|2.5|15|25|120|600)(\.0)?

      # ---- namespaces filter ----
      - sourceLabels: [namespace]
        regex: home-assistant
        action: keep

prometheusOperator:
  admissionWebhooks:
    enabled: true
    certManager:
      enabled: true
    patch:
      enabled: false
